<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <title>Ø¨Ø§Ø²ÛŒ Ø§Ù…Ù„Ø§: Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø­Ø±ÙˆÙ Ùˆ Ø¬Ù…Ù„Ø§Øª (Ù…Ø®ØµÙˆØµ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø§Ø¨ØªØ¯Ø§ÛŒÛŒ)</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    :root {
      --bg: #fffdf8;
      --card: #fff;
      --accent: #ff6f61;
      --ok: #2ecc71;
      --bad: #e74c3c;
      --highlight: #ffd700;
      --text: #2c3e50;
      --sidebar-bg: rgba(255, 255, 255, 0.98);
      --slot-bg: linear-gradient(180deg, #fff, #f7fbff);
      --slot-filled-bg: linear-gradient(180deg, #f6fff5, #e6fff0);
      --msg-bg: #fff9eb;
      --msg-border: #ffe6a8;
      --table-header: #4CAF50;
      --table-row-odd: #e6fff0;
      --table-row-even: #f0f8ff;
    }
    [data-theme="dark"] {
      --bg: #1a1a1a;
      --card: #2c2c2c;
      --accent: #ff8781;
      --ok: #27ae60;
      --bad: #c0392b;
      --highlight: #ffca28;
      --text: #ecf0f1;
      --sidebar-bg: rgba(44, 44, 44, 0.98);
      --slot-bg: linear-gradient(180deg, #2c2c2c, #333);
      --slot-filled-bg: linear-gradient(180deg, #2ecc71, #27ae60);
      --msg-bg: #3c2f2f;
      --msg-border: #e67e22;
      --table-header: #388E3C;
      --table-row-odd: #2f4b3f;
      --table-row-even: #3b4a5c;
    }
    html, body {
      margin: 0;
      font-family: Tahoma, 'Vazir', Arial, sans-serif;
      background: linear-gradient(45deg, #ffecd2, #fce6e6, #e6fffd);
      background-size: 200% 200%;
      animation: gradientShift 15s ease infinite;
      overscroll-behavior: none;
    }
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    @keyframes pulse {
      0% { transform: scale(1); box-shadow: 0 0 0 rgba(255, 111, 97, 0.4); }
      50% { transform: scale(1.1); box-shadow: 0 0 15px rgba(255, 111, 97, 0.6); }
      100% { transform: scale(1); box-shadow: 0 0 0 rgba(255, 111, 97, 0.4); }
    }
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      color: var(--text);
    }
    .wrap {
      width: 100%;
      max-width: 980px;
      padding: 12px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      gap: 12px;
      min-height: 100vh;
    }
    header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      gap: 8px;
    }
    h1 {
      margin: 0;
      font-size: clamp(16px, 5vw, 18px);
    }
    .top-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
    }
    button {
      background: var(--accent);
      color: #fff;
      border: 0;
      padding: 6px 10px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
      font-size: clamp(12px, 4vw, 14px);
      touch-action: manipulation;
      transition: transform 0.2s, background 0.2s;
    }
    button:hover {
      transform: scale(1.05);
      background: #e65b50;
    }
    button.secondary {
      background: #7a8aa6;
    }
    button.secondary:hover {
      background: #5f6f8a;
    }
    main {
      display: grid;
      grid-template-columns: 1fr 300px;
      gap: 12px;
      flex-grow: 1;
    }
    .stage {
      background: var(--slot-bg);
      padding: 12px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(12, 40, 80, 0.06);
      min-height: 300px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .prompt {
      font-weight: 800;
      font-size: clamp(16px, 5vw, 18px);
      text-align: center;
    }
    .progress-bar-container {
      width: 100%;
      height: 10px;
      background: #e6e6e6;
      border-radius: 5px;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      background: var(--ok);
      width: 0%;
      transition: width 0.3s ease;
    }
    .timer-circle {
      width: 50px;
      height: 50px;
      margin: 0 auto;
      position: relative;
    }
    .timer-circle svg {
      transform: rotate(-90deg);
    }
    .timer-circle .circle-bg {
      fill: none;
      stroke: #e6e6e6;
      stroke-width: 4;
    }
    .timer-circle .circle-progress {
      fill: none;
      stroke: var(--accent);
      stroke-width: 4;
      stroke-linecap: round;
      transition: stroke-dashoffset 1s linear;
    }
    .timer-circle .timer-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: clamp(12px, 4vw, 14px);
      font-weight: 700;
    }
    .scrambled {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      padding: 8px;
    }
    .tile {
      width: clamp(60px, 18vw, 80px);
      height: clamp(60px, 18vw, 80px);
      border-radius: 10px;
      background: var(--card);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(20px, 6vw, 24px);
      font-weight: 900;
      box-shadow: 0 8px 12px rgba(20, 40, 80, 0.06);
      cursor: move;
      user-select: none;
      touch-action: none;
      position: relative;
      z-index: 10;
      transition: transform 0.2s, box-shadow 0.2s, background 0.3s;
    }
    .tile:hover {
      transform: scale(1.05);
      box-shadow: 0 10px 20px rgba(20, 40, 80, 0.1), 0 0 10px rgba(255, 111, 97, 0.3);
    }
    .tile.dragging {
      opacity: 0.85;
      transform: scale(1.06);
      z-index: 1000;
    }
    .tile.correct {
      background: var(--ok);
      transition: background 0.2s;
    }
    .tile.incorrect {
      background: var(--bad);
      transition: background 0.2s;
    }
    .slot-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      padding: 8px;
    }
    .slot {
      width: clamp(60px, 18vw, 80px);
      height: clamp(60px, 18vw, 80px);
      border-radius: 10px;
      border: 2px dashed #e6eefc;
      background: var(--slot-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(18px, 5vw, 20px);
      font-weight: 800;
      cursor: pointer;
      position: relative;
      z-index: 5;
      transition: border 0.2s, background 0.2s, outline 0.2s;
    }
    .slot.filled {
      border-style: solid;
      border-color: var(--ok);
      background: var(--slot-filled-bg);
    }
    .slot.incorrect {
      animation: shake 0.3s;
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      50% { transform: translateX(5px); }
      75% { transform: translateX(-5px); }
    }
    aside {
      background: var(--sidebar-bg);
      padding: 12px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(12, 40, 80, 0.05);
      height: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    label {
      font-weight: 700;
      font-size: clamp(12px, 4vw, 13px);
    }
    input[type="number"], input[type="text"] {
      width: 100%;
      max-width: 200px;
      padding: 6px;
      border-radius: 8px;
      border: 1px solid #dde;
      font-size: clamp(12px, 4vw, 14px);
      background: var(--card);
      color: var(--text);
    }
    textarea {
      width: 100%;
      height: 120px;
      border-radius: 8px;
      padding: 8px;
      border: 1px solid #dde;
      resize: vertical;
      font-size: clamp(12px, 4vw, 14px);
      background: var(--card);
      color: var(--text);
    }
    .score, .stats, .moves, .mistakes {
      font-size: clamp(14px, 4.5vw, 16px);
      font-weight: 800;
    }
    .progress {
      font-size: clamp(12px, 4vw, 14px);
      font-weight: 700;
    }
    .level {
      font-size: clamp(12px, 4vw, 14px);
      font-weight: 700;
      color: #8e44ad;
    }
    .streak {
      font-size: clamp(12px, 4vw, 14px);
      font-weight: 700;
      color: #e67e22;
    }
    .msg {
      padding: 8px;
      border-radius: 8px;
      background: var(--msg-bg);
      border: 1px dashed var(--msg-border);
      font-size: clamp(12px, 4vw, 14px);
    }
    footer.small {
      font-size: clamp(11px, 3.5vw, 12px);
      color: var(--text);
      margin-top: auto;
    }
    #printFrame {
      display: none;
    }
    .report-card-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      font-family: 'Vazir', sans-serif;
      direction: rtl;
      text-align: right;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 8px 20px rgba(12, 40, 80, 0.1);
    }
    .report-card-table th, .report-card-table td {
      border: 1px solid #ddd;
      padding: 12px;
      font-size: 14px;
    }
    .report-card-table th {
      background-color: var(--table-header);
      color: white;
      font-weight: bold;
    }
    .report-card-table tr:nth-child(odd) {
      background-color: var(--table-row-odd);
    }
    .report-card-table tr:nth-child(even) {
      background-color: var(--table-row-even);
    }
    @media (max-width: 880px) {
      main {
        grid-template-columns: 1fr;
      }
      .wrap {
        padding: 8px;
      }
      .stage {
        min-height: 250px;
      }
      .tile, .slot {
        width: clamp(50px, 20vw, 70px);
        height: clamp(50px, 20vw, 70px);
      }
      .tile {
        font-size: clamp(18px, 5.5vw, 22px);
      }
      .slot {
        font-size: clamp(16px, 5vw, 18px);
      }
    }
    @media (max-width: 480px) {
      h1 {
        font-size: clamp(14px, 4.5vw, 16px);
      }
      button {
        padding: 5px 8px;
        font-size: clamp(11px, 3.5vw, 12px);
      }
      .prompt {
        font-size: clamp(14px, 4.5vw, 16px);
      }
      textarea {
        height: 100px;
      }
      input[type="number"], input[type="text"] {
        max-width: 100%;
      }
      .timer-circle {
        width: 40px;
        height: 40px;
      }
      .report-card-table th, .report-card-table td {
        font-size: 12px;
        padding: 8px;
      }
    }
  </style>
</head>
<body>
  <audio id="bgMusic" autoplay loop>
    <source src="background_music.mp3" type="audio/mpeg">
    Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø² Ù¾Ø®Ø´ ØµØ¯Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
  </audio>
  <div class="wrap">
    <header>
      <h1>ğŸ“ Ø¨Ø§Ø²ÛŒ Ø§Ù…Ù„Ø§: Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø­Ø±ÙˆÙ Ùˆ Ø¬Ù…Ù„Ø§Øª (Ù…Ø®ØµÙˆØµ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø§Ø¨ØªØ¯Ø§ÛŒÛŒ)</h1>
      <div class="top-controls">
        <button id="newBtn">ğŸ” Ø¬Ø¯ÛŒØ¯</button>
        <button id="checkBtn">âœ” Ø¨Ø±Ø±Ø³ÛŒ</button>
        <button id="retryBtn" class="secondary">ğŸ”„ Ø¯ÙˆØ¨Ø§Ø±Ù‡</button>
        <button id="themeBtn" class="secondary">ğŸŒ™ ØªÙ…</button>
        <button id="resetBtn" class="secondary">ğŸ—‘ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ</button>
        <button id="printBtn" class="secondary">ğŸ–¨ Ú†Ø§Ù¾ Ú©Ø§Ø±Ù†Ø§Ù…Ù‡</button>
      </div>
    </header>
    <main>
      <section class="stage" id="stage">
        <div class="prompt" id="prompt">Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Â«Ø¬Ø¯ÛŒØ¯Â» Ø±Ø§ Ø¨Ø²Ù†</div>
        <div class="timer-circle" id="timerCircle" style="display: none;">
          <svg width="50" height="50">
            <circle class="circle-bg" cx="25" cy="25" r="22" />
            <circle class="circle-progress" cx="25" cy="25" r="22" stroke-dasharray="138" stroke-dashoffset="0" />
          </svg>
          <div class="timer-text" id="timerText">0</div>
        </div>
        <div class="progress" id="progress">Ù¾ÛŒØ´Ø±ÙØª: 0/0</div>
        <div class="progress-bar-container"><div class="progress-bar" id="progressBar"></div></div>
        <div class="level" id="level">Ø³Ø·Ø­: 1</div>
        <div class="streak" id="streak">Ø±Ú¯Ù‡: 0</div>
        <div class="moves" id="moves">Ø­Ø±Ú©Ø§Øª Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: 10</div>
        <div class="mistakes" id="mistakes">Ø§Ø´ØªØ¨Ø§Ù‡Ø§Øª Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: 3</div>
        <div style="font-weight: 700; text-align: center; font-size: clamp(12px, 4vw, 14px)">Ø¬Ø§ÛŒ Ø¯Ø±Ø³Øª Ø±Ø§ Ø¨Ø³Ø§Ø²</div>
        <div class="slot-row" id="slots"></div>
        <div style="display: flex; gap: 8px; justify-content: center; margin-top: 6px">
          <button id="shuffleTiles" class="secondary">ğŸ”€ Ù…Ø®Ù„ÙˆØ· Ú©Ù†</button>
        </div>
      </section>
      <aside>
        <div class="score">Ø§Ù…ØªÛŒØ§Ø²: <span id="score">0</span></div>
        <div class="stats">Ø¯Ù‚Øª: <span id="accuracy">0%</span> | Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø²Ù…Ø§Ù†: <span id="avgTime">0 Ø«Ø§Ù†ÛŒÙ‡</span></div>
        <div class="msg" id="msg">Ù‡Ø± Ø¨Ø§Ø± Ú©Ù‡ Ú©Ù„Ù…Ù‡ ÛŒØ§ Ø¬Ù…Ù„Ù‡ Ø±Ø§ Ø¯Ø±Ø³Øª Ø¨Ø³Ø§Ø²ÛŒ Ø§Ù…ØªÛŒØ§Ø² Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒ. ÙÙ‚Ø· Ø¬Ù…Ù„Ø§Øª ÙˆØ§Ø±Ø¯ Ú©Ù†!</div>
        <div style="font-weight: 700; font-size: clamp(12px, 4vw, 14px)">Ù‚Ø·Ø¹Ø§Øª (Ù„Ù…Ø³/Ú©Ù„ÛŒÚ© Ùˆ Ø¨Ú©Ø´)</div>
        <div class="scrambled" id="scrambled"></div>
        <label for="wordList">ÙÙ‡Ø±Ø³Øª Ø¬Ù…Ù„Ø§Øª (ÛŒÚ© Ø¬Ù…Ù„Ù‡ Ø¯Ø± Ù‡Ø± Ø®Ø·)</label>
        <textarea id="wordList">Ù…Ù† Ø¨Ù‡ Ù…Ø¯Ø±Ø³Ù‡ Ù…ÛŒâ€ŒØ±ÙˆÙ…
Ø§ÛŒÙ† ÛŒÚ© Ú©ØªØ§Ø¨ Ø§Ø³Øª
Ù…Ø§ Ø¨Ø§Ø²ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
Ø®ÙˆØ±Ø´ÛŒØ¯ Ø¯Ø± Ø¢Ø³Ù…Ø§Ù† Ø§Ø³Øª
Ú¯Ø±Ø¨Ù‡ Ø±ÙˆÛŒ Ø¯ÛŒÙˆØ§Ø± Ø§Ø³Øª
Ù…Ù† Ø³ÛŒØ¨ Ù…ÛŒâ€ŒØ®ÙˆØ±Ù…
Ú©ØªØ§Ø¨ Ø±ÙˆÛŒ Ù…ÛŒØ² Ø§Ø³Øª
Ù…Ø§ Ø¨Ù‡ Ù¾Ø§Ø±Ú© Ù…ÛŒâ€ŒØ±ÙˆÛŒÙ…
Ù¾Ø±Ù†Ø¯Ù‡ Ø¯Ø± Ø¢Ø³Ù…Ø§Ù† Ù¾Ø±ÙˆØ§Ø² Ù…ÛŒâ€ŒÚ©Ù†Ø¯
Ø§Ù…Ø±ÙˆØ² Ø±ÙˆØ² Ø®ÙˆØ¨ÛŒ Ø§Ø³Øª</textarea>
        <label for="timerDuration">Ù…Ø¯Øª Ø²Ù…Ø§Ù† (Ø«Ø§Ù†ÛŒÙ‡ØŒ 10-60):</label>
        <input type="number" id="timerDuration" min="10" max="60" value="30">
        <div style="display: flex; gap: 8px; flex-wrap: wrap">
          <button id="applyBtn">Ø§Ø¹Ù…Ø§Ù„ ÙÙ‡Ø±Ø³Øª</button>
          <button id="suggestBtn" class="secondary">Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¬Ù…Ù„Ø§Øª</button>
          <button id="modeBtn" class="secondary">Ø­Ø§Ù„Øª: Ø³ÛŒÙ„Ø§Ø¨</button>
          <button id="gameModeBtn" class="secondary">Ø­Ø§Ù„Øª Ø¨Ø§Ø²ÛŒ: Ø¹Ø§Ø¯ÛŒ</button>
        </div>
        <div style="margin-top: 6px; font-size: clamp(11px, 3.5vw, 12px)">ØªÙ†Ø¸ÛŒÙ…Ø§Øª: <br> Ø­Ø§Ù„Øª Â«Ø³ÛŒÙ„Ø§Ø¨Â» â€” Ú©Ù„Ù…Ø§Øª Ø¨Ù‡ Ø¯Ùˆ Ø­Ø±Ù. <br> Ø­Ø§Ù„Øª Â«Ø­Ø±ÙÂ» â€” Ú©Ù„Ù…Ø§Øª Ø¨Ù‡ Ø­Ø±Ù. <br> Ø­Ø§Ù„Øª Â«Ø¬Ù…Ù„Ù‡Â» â€” Ú©Ù„Ù…Ø§Øª ÛŒÚ© Ø¬Ù…Ù„Ù‡. <br> Ø­Ø§Ù„Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ: Ø¹Ø§Ø¯ÛŒØŒ Ø²Ù…Ø§Ù†â€ŒØ¯Ø§Ø±ØŒ Ú†Ø§Ù„Ø´</div>
        <footer class="small">Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒ Ù…Ù† ÙÙ‡Ø±Ø³Øª Ø¬Ù…Ù„Ø§Øª Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø±Ø§ÛŒ Ú¯Ø±ÙˆÙ‡ Ø³Ù†ÛŒ Ø¯Ø±Ø³Øª Ú©Ù†Ù…ØŸ Ø§Ø² Ø¯Ú©Ù…Ù‡ Â«Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¬Ù…Ù„Ø§ØªÂ» Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†.</footer>
      </aside>
    </main>
    <iframe id="printFrame" style="display: none;"></iframe>
  </div>
  <script>
    let WORDS = [
      'Ù…Ù† Ø¨Ù‡ Ù…Ø¯Ø±Ø³Ù‡ Ù…ÛŒâ€ŒØ±ÙˆÙ…',
      'Ø§ÛŒÙ† ÛŒÚ© Ú©ØªØ§Ø¨ Ø§Ø³Øª',
      'Ù…Ø§ Ø¨Ø§Ø²ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…',
      'Ø®ÙˆØ±Ø´ÛŒØ¯ Ø¯Ø± Ø¢Ø³Ù…Ø§Ù† Ø§Ø³Øª',
      'Ú¯Ø±Ø¨Ù‡ Ø±ÙˆÛŒ Ø¯ÛŒÙˆØ§Ø± Ø§Ø³Øª',
      'Ù…Ù† Ø³ÛŒØ¨ Ù…ÛŒâ€ŒØ®ÙˆØ±Ù…',
      'Ú©ØªØ§Ø¨ Ø±ÙˆÛŒ Ù…ÛŒØ² Ø§Ø³Øª',
      'Ù…Ø§ Ø¨Ù‡ Ù¾Ø§Ø±Ú© Ù…ÛŒâ€ŒØ±ÙˆÛŒÙ…',
      'Ù¾Ø±Ù†Ø¯Ù‡ Ø¯Ø± Ø¢Ø³Ù…Ø§Ù† Ù¾Ø±ÙˆØ§Ø² Ù…ÛŒâ€ŒÚ©Ù†Ø¯',
      'Ø§Ù…Ø±ÙˆØ² Ø±ÙˆØ² Ø®ÙˆØ¨ÛŒ Ø§Ø³Øª'
    ];
    let current = null;
    let currentSentence = null;
    let tiles = [];
    let mode = 'syllable';
    let gameMode = 'normal';
    let score = 0;
    let completedWords = 0;
    let totalWords = 0;
    let streak = 0;
    let level = 1;
    let draggingEl = null;
    let timerInterval = null;
    let timeLeft = 30;
    let totalAttempts = 0;
    let correctAttempts = 0;
    let roundStartTime = 0;
    let totalRoundTime = 0;
    let moveCount = 10; // Ù…Ø­Ø¯ÙˆØ¯ÛŒØª ØªØ¹Ø¯Ø§Ø¯ Ø­Ø±Ú©Øª
    let maxMoves = 10; // Ø­Ø¯Ø§Ú©Ø«Ø± Ø­Ø±Ú©Ø§Øª Ø¯Ø± Ù‡Ø± Ø¯ÙˆØ±
    let mistakeCount = 3; // Ù…Ø­Ø¯ÙˆØ¯ÛŒØª ØªØ¹Ø¯Ø§Ø¯ Ø§Ø´ØªØ¨Ø§Ù‡
    let maxMistakes = 3; // Ø­Ø¯Ø§Ú©Ø«Ø± Ø§Ø´ØªØ¨Ø§Ù‡Ø§Øª Ø¯Ø± Ù‡Ø± Ø¯ÙˆØ±
    let consecutiveMistakes = 0; // Ø¨Ø±Ø§ÛŒ Ø¯Ø´ÙˆØ§Ø±ÛŒ Ù¾ÙˆÛŒØ§
    let usedSentences = JSON.parse(localStorage.getItem('usedSentences')) || [];
    let achievements = JSON.parse(localStorage.getItem('achievements')) || {
      fiveInRow: false,
      tenPoints: false
    };
    let userInfo = JSON.parse(localStorage.getItem('userInfo')) || {
      firstName: '',
      lastName: '',
      nationalId: '',
      schoolName: '',
      grade: ''
    };
    let settings = JSON.parse(localStorage.getItem('settings')) || {
      mode: 'syllable',
      gameMode: 'normal',
      timerDuration: 30,
      theme: 'light'
    };
    const encouragementMessages = [
      'Ø¹Ø§Ù„ÛŒ Ø¨ÙˆØ¯ØŒ ØªÙˆ ÛŒÙ‡ Ø³ØªØ§Ø±Ù‡ Ø¯Ø±Ø®Ø´Ø§Ù† Ø§Ù…Ù„Ø§ÛŒÛŒ! ğŸŒŸ',
      'Ø¢ÙØ±ÛŒÙ†ØŒ Ø§Ù†Ú¯Ø§Ø± Ø¨Ø§ Ø¬Ø§Ø¯ÙˆÛŒ Ø§Ù…Ù„Ø§ Ù‡Ù…Ù‡ Ø±Ùˆ ØºØ§ÙÙ„Ú¯ÛŒØ± Ú©Ø±Ø¯ÛŒ! ğŸ§™â€â™‚ï¸',
      'ÙˆØ§ÛŒØŒ Ú†Ù‡ Ø³Ø±Ø¹Øª Ùˆ Ø¯Ù‚ØªÛŒ! ØªÙˆ ÛŒÙ‡ Ù…ÙˆØ´Ú© Ø§Ù…Ù„Ø§ÛŒÛŒ! ğŸš€',
      'Ø®ÙˆØ¨ Ø¨ÙˆØ¯ØŒ Ø­Ø§Ù„Ø§ ÛŒÚ©ÛŒ Ø¯ÛŒÚ¯Ù‡ØŒ Ù¾Ø§Ø¯Ø´Ø§Ù‡ Ø§Ù…Ù„Ø§! ğŸ‘‘',
      'ÙÙˆÙ‚â€ŒØ§Ù„Ø¹Ø§Ø¯Ù‡! Ø§Ù†Ú¯Ø§Ø± Ø§Ù…Ù„Ø§ Ø±Ùˆ Ø¨Ø§ Ú†Ø´Ù…Ø§ÛŒ Ø¨Ø³ØªÙ‡ Ø­Ù„ Ú©Ø±Ø¯ÛŒ! ğŸ˜',
      'Ù‡ÙˆØ±Ø§! Ø§ÛŒÙ† ÛŒÚ©ÛŒ Ø±Ùˆ Ù…Ø«Ù„ ÛŒÙ‡ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ ØªØ±Ú©ÙˆÙ†Ø¯ÛŒ! ğŸ’¥',
      'ØªÙˆ Ø¨Ù‡ØªØ±ÛŒÙ†ÛŒ! Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ§ÛŒ ÛŒÙ‡ Ø§Ù…Ù„Ø§ÛŒ Ø¯ÛŒÚ¯Ù‡ Ø±Ùˆ ÙØªØ­ Ú©Ù†ÛŒØŸ âš”ï¸',
      'Ø¢Ø® Ø¬ÙˆÙ†! Ø§Ù†Ú¯Ø§Ø± Ø¯Ø§Ø±ÛŒ Ø¨Ø§ Ø§Ù…Ù„Ø§ Ù†Ù‚Ø§Ø´ÛŒâ€ŒÙ‡Ø§ÛŒ Ø±Ù†Ú¯Ø§Ø±Ù†Ú¯ Ù…ÛŒâ€ŒÚ©Ø´ÛŒ! ğŸ¨',
      'ÙˆØ§ÛŒØŒ ØªÙˆ ÛŒÙ‡ ØºÙˆÙ„ Ø§Ù…Ù„Ø§ÛŒÛŒ Ù‡Ø³ØªÛŒ Ú©Ù‡ Ù‡Ù…Ù‡ Ø±Ùˆ Ø´Ú¯ÙØªâ€ŒØ²Ø¯Ù‡ Ú©Ø±Ø¯! ğŸ˜'
    ];

    const scrambledEl = document.getElementById('scrambled');
    const slotsEl = document.getElementById('slots');
    const promptEl = document.getElementById('prompt');
    const scoreEl = document.getElementById('score');
    const progressEl = document.getElementById('progress');
    const progressBarEl = document.getElementById('progressBar');
    const levelEl = document.getElementById('level');
    const streakEl = document.getElementById('streak');
    const movesEl = document.getElementById('moves');
    const mistakesEl = document.getElementById('mistakes');
    const msgEl = document.getElementById('msg');
    const wordListEl = document.getElementById('wordList');
    const timerDurationEl = document.getElementById('timerDuration');
    const timerCircleEl = document.getElementById('timerCircle');
    const timerTextEl = document.getElementById('timerText');
    const accuracyEl = document.getElementById('accuracy');
    const avgTimeEl = document.getElementById('avgTime');

    function loadWordList() {
      const savedWords = localStorage.getItem('wordList');
      if (savedWords) {
        WORDS = JSON.parse(savedWords).map(s => normalizePersian(s)).filter(Boolean);
      }
      wordListEl.value = WORDS.join('\n');
    }

    function saveWordList() {
      const newWords = wordListEl.value.split('\n').map(s => normalizePersian(s)).filter(Boolean);
      if (newWords.length === 0) {
        Swal.fire({
          icon: 'error',
          title: 'Ø®Ø·Ø§',
          text: 'Ù„Ø·ÙØ§Ù‹ Ø¯Ø³Øªâ€ŒÚ©Ù… ÛŒÚ© Ø¬Ù…Ù„Ù‡ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯',
          confirmButtonText: 'Ø¨Ø§Ø´Ù‡'
        });
        return;
      }
      WORDS = newWords;
      localStorage.setItem('wordList', JSON.stringify(WORDS));
      usedSentences = [];
      localStorage.setItem('usedSentences', JSON.stringify(usedSentences));
      Swal.fire({
        icon: 'success',
        title: 'Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯',
        text: 'ÙÙ‡Ø±Ø³Øª Ø¬Ù…Ù„Ø§Øª Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯. Ø­Ø§Ù„Ø§ Â«Ø¬Ø¯ÛŒØ¯Â» Ø±Ø§ Ø¨Ø²Ù†.',
        timer: 1500,
        showConfirmButton: false
      });
    }

    function saveSettings() {
      settings = {
        mode,
        gameMode,
        timerDuration: parseInt(timerDurationEl.value) || 30,
        theme: document.documentElement.getAttribute('data-theme') || 'light'
      };
      localStorage.setItem('settings', JSON.stringify(settings));
    }

    function loadSettings() {
      mode = settings.mode || 'syllable';
      gameMode = settings.gameMode || 'normal';
      timerDurationEl.value = settings.timerDuration || 30;
      if (settings.theme === 'dark') {
        document.documentElement.setAttribute('data-theme', 'dark');
        document.getElementById('themeBtn').textContent = 'â˜€ï¸ ØªÙ…';
      }
      document.getElementById('modeBtn').textContent = `Ø­Ø§Ù„Øª: ${mode === 'syllable' ? 'Ø³ÛŒÙ„Ø§Ø¨' : mode === 'letter' ? 'Ø­Ø±Ù' : 'Ø¬Ù…Ù„Ù‡'}`;
      document.getElementById('gameModeBtn').textContent = `Ø­Ø§Ù„Øª Ø¨Ø§Ø²ÛŒ: ${gameMode === 'normal' ? 'Ø¹Ø§Ø¯ÛŒ' : gameMode === 'timed' ? 'Ø²Ù…Ø§Ù†â€ŒØ¯Ø§Ø±' : 'Ú†Ø§Ù„Ø´'}`;
    }

    function normalizePersian(s) {
      return (s || '').replace(/\u200c/g, '').replace(/[\s]+/g, ' ').replace(/[Ø¢Ø£Ø¥]/g, 'Ø§').replace(/ÙŠ/g, 'ÛŒ').replace(/Ùƒ/g, 'Ú©').trim();
    }

    function splitSyllables(word) {
      const chars = Array.from(word.replace(/\s/g, ''));
      const parts = [];
      for (let i = 0; i < chars.length; i += 2) {
        parts.push(chars.slice(i, i + 2).join(''));
      }
      return parts.length > 0 ? parts : splitLetters(word);
    }

    function splitLetters(word) {
      return Array.from(word.replace(/\s/g, ''));
    }

    function splitSentence(sentence) {
      return sentence.split(/\s+/).filter(Boolean);
    }

    function shuffle(a) {
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function updateLevel() {
      const newLevel = Math.floor(completedWords / 5) + 1;
      if (newLevel !== level) {
        level = newLevel;
        levelEl.textContent = `Ø³Ø·Ø­: ${level}`;
        levelEl.style.animation = 'pulse 1s';
        setTimeout(() => levelEl.style.animation = '', 1000);
        Swal.fire({
          icon: 'success',
          title: 'Ø³Ø·Ø­ Ø¬Ø¯ÛŒØ¯!',
          text: `ØªØ¨Ø±ÛŒÚ©! Ø¨Ù‡ Ø³Ø·Ø­ ${level} Ø±Ø³ÛŒØ¯ÛŒ!`,
          timer: 1500,
          showConfirmButton: false
        });
      }
    }

    function updateStats() {
      const accuracy = totalAttempts > 0 ? Math.round((correctAttempts / totalAttempts) * 100) : 0;
      const avgTime = completedWords > 0 ? Math.round(totalRoundTime / completedWords) : 0;
      accuracyEl.textContent = `${accuracy}%`;
      avgTimeEl.textContent = `${avgTime} Ø«Ø§Ù†ÛŒÙ‡`;
    }

    function selectSentenceByDifficulty() {
      let availableSentences = WORDS.filter(s => !usedSentences.includes(s));
      if (availableSentences.length === 0) {
        usedSentences = [];
        availableSentences = WORDS;
      }
      if (gameMode === 'challenge') {
        // Ø¯Ø± Ø­Ø§Ù„Øª Ú†Ø§Ù„Ø´ØŒ Ø¬Ù…Ù„Ø§Øª Ø¨Ø± Ø§Ø³Ø§Ø³ Ø·ÙˆÙ„ Ù…Ø±ØªØ¨ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
        return availableSentences.sort((a, b) => a.length - b.length)[Math.min(completedWords, availableSentences.length - 1)];
      }
      // Ø¯Ø´ÙˆØ§Ø±ÛŒ Ù¾ÙˆÛŒØ§: Ø¨Ø± Ø§Ø³Ø§Ø³ streak Ùˆ consecutiveMistakes
      if (streak >= 5) {
        // Ø§Ù†ØªØ®Ø§Ø¨ Ø¬Ù…Ù„Ø§Øª Ø·ÙˆÙ„Ø§Ù†ÛŒâ€ŒØªØ± (Ø¨ÛŒØ´ Ø§Ø² 15 Ú©Ø§Ø±Ø§Ú©ØªØ±)
        const longSentences = availableSentences.filter(s => s.length > 15);
        return longSentences.length > 0 ? longSentences[Math.floor(Math.random() * longSentences.length)] : availableSentences[Math.floor(Math.random() * availableSentences.length)];
      } else if (consecutiveMistakes >= 3) {
        // Ø§Ù†ØªØ®Ø§Ø¨ Ø¬Ù…Ù„Ø§Øª Ú©ÙˆØªØ§Ù‡â€ŒØªØ± (Ú©Ù…ØªØ± Ø§Ø² 10 Ú©Ø§Ø±Ø§Ú©ØªØ±)
        const shortSentences = availableSentences.filter(s => s.length <= 10);
        return shortSentences.length > 0 ? shortSentences[Math.floor(Math.random() * shortSentences.length)] : availableSentences[Math.floor(Math.random() * availableSentences.length)];
      }
      // Ø§Ù†ØªØ®Ø§Ø¨ ØªØµØ§Ø¯ÙÛŒ Ø¯Ø± Ø­Ø§Ù„Øª Ø¹Ø§Ø¯ÛŒ
      return availableSentences[Math.floor(Math.random() * availableSentences.length)];
    }

    function newRound() {
      if (WORDS.length === 0) {
        Swal.fire({
          icon: 'error',
          title: 'Ø®Ø·Ø§',
          text: 'Ù„Ø·ÙØ§Ù‹ Ø¯Ø³Øªâ€ŒÚ©Ù… ÛŒÚ© Ø¬Ù…Ù„Ù‡ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯',
        });
        return;
      }
      currentSentence = selectSentenceByDifficulty();
      usedSentences.push(currentSentence);
      localStorage.setItem('usedSentences', JSON.stringify(usedSentences));
      const sentenceWords = splitSentence(currentSentence);
      current = mode === 'sentence' ? currentSentence : sentenceWords[Math.floor(Math.random() * sentenceWords.length)];
      promptEl.textContent = gameMode === 'timed' ? `Ø²Ù…Ø§Ù†: ${timeLeft} Ø«Ø§Ù†ÛŒÙ‡` : mode === 'sentence' ? 'Ø¬Ù…Ù„Ù‡ Ø¬Ø¯ÛŒØ¯ â€” ØªØ±ØªÛŒØ¨ Ø±Ø§ Ø¯Ø±Ø³Øª Ú©Ù†' : `Ú©Ù„Ù…Ù‡ Ø¬Ø¯ÛŒØ¯ â€” ØªØ±ØªÛŒØ¨ Ø±Ø§ Ø¯Ø±Ø³Øª Ú©Ù†: ${current}`;
      tiles = mode === 'sentence' ? splitSentence(current) : mode === 'syllable' ? splitSyllables(current) : splitLetters(current);
      if (tiles.length === 0) tiles = splitLetters(current);
      totalWords++;
      moveCount = maxMoves; // Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø­Ø±Ú©Ø§Øª
      mistakeCount = maxMistakes; // Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø§Ø´ØªØ¨Ø§Ù‡Ø§Øª
      movesEl.textContent = `Ø­Ø±Ú©Ø§Øª Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: ${moveCount}`;
      mistakesEl.textContent = `Ø§Ø´ØªØ¨Ø§Ù‡Ø§Øª Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: ${mistakeCount}`;
      updateProgress();
      renderTiles();
      renderSlots();
      if (gameMode === 'timed') {
        timeLeft = parseInt(timerDurationEl.value) || 30;
        timeLeft = Math.max(10, Math.min(60, timeLeft));
        timerCircleEl.style.display = 'block';
        promptEl.textContent = `Ø²Ù…Ø§Ù†: ${timeLeft} Ø«Ø§Ù†ÛŒÙ‡`;
        updateTimerCircle();
        clearInterval(timerInterval);
        roundStartTime = Date.now();
        timerInterval = setInterval(() => {
          timeLeft--;
          promptEl.textContent = `Ø²Ù…Ø§Ù†: ${timeLeft} Ø«Ø§Ù†ÛŒÙ‡`;
          timerTextEl.textContent = timeLeft;
          updateTimerCircle();
          if (timeLeft <= 0) {
            clearInterval(timerInterval);
            timerCircleEl.style.display = 'none';
            Swal.fire({
              icon: 'error',
              title: 'Ø²Ù…Ø§Ù† ØªÙ…Ø§Ù… Ø´Ø¯!',
              text: 'Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù† ÛŒØ§ Ø§Ø² Â«Ø¬Ø¯ÛŒØ¯Â» Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†.',
              confirmButtonText: 'Ø¨Ø§Ø´Ù‡'
            });
            streak = 0;
            consecutiveMistakes++;
            updateStreak();
            retryRound();
          }
        }, 1000);
      } else {
        timerCircleEl.style.display = 'none';
        roundStartTime = Date.now();
      }
      saveSettings();
    }

    function updateProgress() {
      progressEl.textContent = `Ù¾ÛŒØ´Ø±ÙØª: ${completedWords}/${totalWords}`;
      const progressPercent = totalWords > 0 ? (completedWords / totalWords) * 100 : 0;
      progressBarEl.style.width = `${progressPercent}%`;
      updateLevel();
      updateStats();
    }

    function updateStreak() {
      streakEl.textContent = `Ø±Ú¯Ù‡: ${streak}`;
    }

    function updateTimerCircle() {
      const totalTime = parseInt(timerDurationEl.value) || 30;
      const progress = timeLeft / totalTime;
      const dashOffset = 138 * (1 - progress);
      document.querySelector('.circle-progress').style.strokeDashoffset = dashOffset;
    }

    function renderTiles() {
      scrambledEl.innerHTML = '';
      const shuffledTiles = shuffle(tiles.map((x, i) => ({ id: i, text: x })));
      shuffledTiles.forEach(obj => {
        const tile = document.createElement('div');
        tile.className = 'tile';
        tile.textContent = obj.text;
        tile.dataset.text = obj.text;
        tile.dataset.id = obj.id;
        scrambledEl.appendChild(tile);
        enableDrag(tile);
      });
    }

    function renderSlots() {
      slotsEl.innerHTML = '';
      tiles.forEach((_, i) => {
        const slot = document.createElement('div');
        slot.className = 'slot';
        slot.dataset.index = i;
        slot.dataset.occupied = 'false';
        slot.addEventListener('click', () => handleSlotClick(slot));
        slotsEl.appendChild(slot);
      });
    }

    function enableDrag(el) {
      el.addEventListener('pointerdown', e => {
        e.preventDefault();
        if (draggingEl) return;
        draggingEl = el;
        el.setPointerCapture(e.pointerId);
        el.classList.add('dragging');
        const rect = el.getBoundingClientRect();
        const offsetX = e.clientX - rect.left;
        const offsetY = e.clientY - rect.top;
        el.style.position = 'fixed';
        el.style.left = rect.left + 'px';
        el.style.top = rect.top + 'px';
        el.style.zIndex = '1000';

        function onMove(ev) {
          ev.preventDefault();
          el.style.left = (ev.clientX - offsetX) + 'px';
          el.style.top = (ev.clientY - offsetY) + 'px';
        }

        function onUp(ev) {
          ev.preventDefault();
          el.releasePointerCapture(e.pointerId);
          document.removeEventListener('pointermove', onMove);
          document.removeEventListener('pointerup', onUp);
          el.classList.remove('dragging');

          el.style.visibility = 'hidden';
          const dropped = document.elementFromPoint(ev.clientX, ev.clientY);
          el.style.visibility = '';
          
          const slot = dropped?.closest('.slot');
          if (slot && slot.dataset.occupied === 'false' && validateDrop(slot, el)) {
            slot.textContent = el.dataset.text;
            slot.dataset.occupied = 'true';
            slot.style.transition = 'all 0.2s ease';
            slot.style.transform = 'scale(1.1)';
            setTimeout(() => slot.style.transform = 'scale(1)', 200);
            el.classList.add('correct');
            setTimeout(() => el.classList.remove('correct'), 300);
            el.remove();
            moveCount--;
            movesEl.textContent = `Ø­Ø±Ú©Ø§Øª Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: ${moveCount}`;
            if (moveCount <= 0) {
              Swal.fire({
                icon: 'error',
                title: 'Ø­Ø±Ú©Ø§Øª ØªÙ…Ø§Ù… Ø´Ø¯!',
                text: 'ØªØ¹Ø¯Ø§Ø¯ Ø­Ø±Ú©Ø§ØªØª ØªÙ…ÙˆÙ… Ø´Ø¯. Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù† ÛŒØ§ Ø§Ø² Â«Ø¬Ø¯ÛŒØ¯Â» Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†.',
                confirmButtonText: 'Ø¨Ø§Ø´Ù‡'
              });
              streak = 0;
              consecutiveMistakes++;
              updateStreak();
              retryRound();
              return;
            }
            checkIfComplete();
          } else {
            el.classList.add('incorrect');
            setTimeout(() => el.classList.remove('incorrect'), 300);
            el.style.transition = 'all 0.3s ease';
            const scrambledRect = scrambledEl.getBoundingClientRect();
            el.style.left = scrambledRect.left + 'px';
            el.style.top = scrambledRect.top + 'px';
            setTimeout(() => {
              el.style.position = '';
              el.style.left = '';
              el.style.top = '';
              el.style.zIndex = '';
              el.style.transition = '';
              scrambledEl.appendChild(el);
            }, 300);
          }
          draggingEl = null;
        }

        document.addEventListener('pointermove', onMove);
        document.addEventListener('pointerup', onUp);
      });
    }

    function validateDrop(slot, tile) {
      if (!slot || slot.dataset.occupied === 'true') return false;
      if (!tile.dataset.text) return false;
      return true;
    }

    function handleSlotClick(slot) {
      if (slot.dataset.occupied === 'true') {
        const text = slot.textContent;
        slot.textContent = '';
        slot.dataset.occupied = 'false';
        slot.classList.remove('filled', 'incorrect');
        slot.style.transform = 'scale(0.9)';
        setTimeout(() => slot.style.transform = 'scale(1)', 200);
        const tile = document.createElement('div');
        tile.className = 'tile';
        tile.textContent = text;
        tile.dataset.text = text;
        scrambledEl.appendChild(tile);
        enableDrag(tile);
        moveCount--;
        movesEl.textContent = `Ø­Ø±Ú©Ø§Øª Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: ${moveCount}`;
        if (moveCount <= 0) {
          Swal.fire({
            icon: 'error',
            title: 'Ø­Ø±Ú©Ø§Øª ØªÙ…Ø§Ù… Ø´Ø¯!',
            text: 'ØªØ¹Ø¯Ø§Ø¯ Ø­Ø±Ú©Ø§ØªØª ØªÙ…ÙˆÙ… Ø´Ø¯. Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù† ÛŒØ§ Ø§Ø² Â«Ø¬Ø¯ÛŒØ¯Â» Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†.',
            confirmButtonText: 'Ø¨Ø§Ø´Ù‡'
          });
          streak = 0;
          consecutiveMistakes++;
          updateStreak();
          retryRound();
          return;
        }
      }
    }

    function checkIfComplete() {
      const slots = Array.from(document.querySelectorAll('.slot'));
      const filled = slots.map(s => s.textContent || '');
      totalAttempts++;
      if (filled.every(Boolean)) {
        const answer = mode === 'sentence' ? filled.join(' ') : filled.join('');
        if (normalizePersian(answer) === normalizePersian(current)) {
          correctAttempts++;
          let multiplier = streak >= 10 ? 3 : streak >= 5 ? 2 : 1;
          score += (gameMode === 'challenge' ? current.length : 1) * multiplier;
          completedWords++;
          streak++;
          consecutiveMistakes = 0; // Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø§Ø´ØªØ¨Ø§Ù‡Ø§Øª Ù…ØªÙˆØ§Ù„ÛŒ
          totalRoundTime += (Date.now() - roundStartTime) / 1000;
          updateProgress();
          updateStreak();
          scoreEl.textContent = score;
          slots.forEach(s => {
            s.classList.add('filled');
            s.style.boxShadow = '0 10px 30px rgba(43, 140, 255, 0.12)';
          });
          confetti({
            particleCount: 300,
            spread: 140,
            origin: { y: 0.5 },
            colors: ['#ff6f61', '#2ecc71', '#ffd700', '#8e44ad', '#3498db']
          });
          checkAchievements();
          const randomMessage = encouragementMessages[Math.floor(Math.random() * encouragementMessages.length)];
          Swal.fire({
            icon: 'success',
            title: 'Ø¢ÙØ±ÛŒÙ†!',
            text: `${randomMessage} Ø§Ù…ØªÛŒØ§Ø²: ${score}${multiplier > 1 ? ` (Ø¶Ø±ÛŒØ¨ x${multiplier})` : ''}`,
            timer: 1500,
            showConfirmButton: false
          });
          clearInterval(timerInterval);
          timerCircleEl.style.display = 'none';
          setTimeout(newRound, 1500);
        } else {
          mistakeCount--;
          consecutiveMistakes++;
          mistakesEl.textContent = `Ø§Ø´ØªØ¨Ø§Ù‡Ø§Øª Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: ${mistakeCount}`;
          if (mistakeCount <= 0) {
            Swal.fire({
              icon: 'error',
              title: 'Ø§Ø´ØªØ¨Ø§Ù‡Ø§Øª ØªÙ…Ø§Ù… Ø´Ø¯!',
              text: 'ØªØ¹Ø¯Ø§Ø¯ Ø§Ø´ØªØ¨Ø§Ù‡Ø§ØªØª ØªÙ…ÙˆÙ… Ø´Ø¯. Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù† ÛŒØ§ Ø§Ø² Â«Ø¬Ø¯ÛŒØ¯Â» Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†.',
              confirmButtonText: 'Ø¨Ø§Ø´Ù‡'
            });
            streak = 0;
            updateStreak();
            retryRound();
            return;
          }
          Swal.fire({
            icon: 'error',
            title: 'Ø§Ø´ØªØ¨Ø§Ù‡!',
            text: `ØªØ±ØªÛŒØ¨ Ø¯Ø±Ø³Øª Ù†ÛŒØ³Øª. Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†. Ø§Ø´ØªØ¨Ø§Ù‡Ø§Øª Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: ${mistakeCount}`,
            confirmButtonText: 'Ø¨Ø§Ø´Ù‡'
          });
          slots.forEach(s => {
            s.classList.remove('filled');
            s.classList.add('incorrect');
            setTimeout(() => s.classList.remove('incorrect'), 300);
          });
          streak = 0;
          updateStreak();
        }
      }
      updateStats();
    }

    function checkAchievements() {
      if (completedWords >= 5 && !achievements.fiveInRow) {
        achievements.fiveInRow = true;
        Swal.fire({
          icon: 'success',
          title: 'Ø¯Ø³ØªØ§ÙˆØ±Ø¯ Ø¬Ø¯ÛŒØ¯!',
          text: 'Ù¾Ù†Ø¬ Ú©Ù„Ù…Ù‡ ÛŒØ§ Ø¬Ù…Ù„Ù‡ Ù¾Ø´Øª Ø³Ø± Ù‡Ù…!',
          confirmButtonText: 'Ø¹Ø§Ù„ÛŒ!'
        });
        scoreEl.style.animation = 'pulse 1s';
        setTimeout(() => scoreEl.style.animation = '', 1000);
      }
      if (score >= 10 && !achievements.tenPoints) {
        achievements.tenPoints = true;
        Swal.fire({
          icon: 'success',
          title: 'Ø¯Ø³ØªØ§ÙˆØ±Ø¯ Ø¬Ø¯ÛŒØ¯!',
          text: 'Ú©Ø³Ø¨ 10 Ø§Ù…ØªÛŒØ§Ø²!',
          confirmButtonText: 'Ø¹Ø§Ù„ÛŒ!'
        });
        scoreEl.style.animation = 'pulse 1s';
        setTimeout(() => scoreEl.style.animation = '', 1000);
      }
      localStorage.setItem('achievements', JSON.stringify(achievements));
    }

    function retryRound() {
      slotsEl.querySelectorAll('.slot').forEach(slot => {
        if (slot.dataset.occupied === 'true') {
          handleSlotClick(slot);
        }
      });
      moveCount = maxMoves; // Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø­Ø±Ú©Ø§Øª
      mistakeCount = maxMistakes; // Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø§Ø´ØªØ¨Ø§Ù‡Ø§Øª
      movesEl.textContent = `Ø­Ø±Ú©Ø§Øª Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: ${moveCount}`;
      mistakesEl.textContent = `Ø§Ø´ØªØ¨Ø§Ù‡Ø§Øª Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: ${mistakeCount}`;
      msgEl.textContent = 'Ø§Ø³Ù„Ø§Øªâ€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯. Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†!';
      streak = 0;
      updateStreak();
    }

    function shuffleTiles() {
      const children = Array.from(scrambledEl.children);
      shuffle(children);
      scrambledEl.innerHTML = '';
      children.forEach(c => scrambledEl.appendChild(c));
    }

    function toggleTheme() {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      if (currentTheme === 'dark') {
        document.documentElement.removeAttribute('data-theme');
        document.getElementById('themeBtn').textContent = 'ğŸŒ™ ØªÙ…';
      } else {
        document.documentElement.setAttribute('data-theme', 'dark');
        document.getElementById('themeBtn').textContent = 'â˜€ï¸ ØªÙ…';
      }
      saveSettings();
    }

    function resetGame() {
      Swal.fire({
        icon: 'warning',
        title: 'Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø¨Ø§Ø²ÛŒ',
        text: 'Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§Ù…ØªÛŒØ§Ø²ØŒ Ø±Ú¯Ù‡ØŒ Ø³Ø·Ø­ Ùˆ Ù¾ÛŒØ´Ø±ÙØª Ø±Ø§ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ú©Ù†ÛŒØ¯ØŸ',
        showCancelButton: true,
        confirmButtonText: 'Ø¨Ù„Ù‡',
        cancelButtonText: 'Ø®ÛŒØ±'
      }).then(result => {
        if (result.isConfirmed) {
          score = 0;
          completedWords = 0;
          totalWords = 0;
          streak = 0;
          level = 1;
          totalAttempts = 0;
          correctAttempts = 0;
          totalRoundTime = 0;
          consecutiveMistakes = 0;
          usedSentences = [];
          achievements = { fiveInRow: false, tenPoints: false };
          localStorage.setItem('usedSentences', JSON.stringify(usedSentences));
          localStorage.setItem('achievements', JSON.stringify(achievements));
          scoreEl.textContent = score;
          updateProgress();
          updateStreak();
          levelEl.textContent = `Ø³Ø·Ø­: ${level}`;
          slotsEl.innerHTML = '';
          scrambledEl.innerHTML = '';
          promptEl.textContent = 'Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Â«Ø¬Ø¯ÛŒØ¯Â» Ø±Ø§ Ø¨Ø²Ù†';
          clearInterval(timerInterval);
          timerCircleEl.style.display = 'none';
          moveCount = maxMoves;
          mistakeCount = maxMistakes;
          movesEl.textContent = `Ø­Ø±Ú©Ø§Øª Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: ${moveCount}`;
          mistakesEl.textContent = `Ø§Ø´ØªØ¨Ø§Ù‡Ø§Øª Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: ${mistakeCount}`;
          Swal.fire({
            icon: 'success',
            title: 'Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø´Ø¯',
            text: 'Ø¨Ø§Ø²ÛŒ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø´Ø¯. Ø­Ø§Ù„Ø§ Â«Ø¬Ø¯ÛŒØ¯Â» Ø±Ø§ Ø¨Ø²Ù†!',
            timer: 1500,
            showConfirmButton: false
          });
        }
      });
    }

    function printReportCard() {
      Swal.fire({
        title: 'Ù…Ø´Ø®ØµØ§Øª Ú©Ø§Ø±Ù†Ø§Ù…Ù‡',
        html:
          `<input type="text" id="firstName" class="swal2-input" placeholder="Ù†Ø§Ù…" value="${userInfo.firstName || ''}">` +
          `<input type="text" id="lastName" class="swal2-input" placeholder="Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ" value="${userInfo.lastName || ''}">` +
          `<input type="text" id="nationalId" class="swal2-input" placeholder="Ú©Ø¯ Ù…Ù„ÛŒ" value="${userInfo.nationalId || ''}">` +
          `<input type="text" id="schoolName" class="swal2-input" placeholder="Ù†Ø§Ù… Ù…Ø¯Ø±Ø³Ù‡" value="${userInfo.schoolName || ''}">` +
          `<input type="text" id="grade" class="swal2-input" placeholder="Ù¾Ø§ÛŒÙ‡ ØªØ­ØµÛŒÙ„ÛŒ" value="${userInfo.grade || ''}">`,
        focusConfirm: false,
        confirmButtonText: 'ØªØ£ÛŒÛŒØ¯ Ùˆ Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ø±Ù†Ø§Ù…Ù‡',
        cancelButtonText: 'Ù„ØºÙˆ',
        showCancelButton: true,
        preConfirm: () => {
          return {
            firstName: document.getElementById('firstName').value || 'Ù†Ø§Ù…',
            lastName: document.getElementById('lastName').value || 'Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ',
            nationalId: document.getElementById('nationalId').value || 'Ú©Ø¯ Ù…Ù„ÛŒ',
            schoolName: document.getElementById('schoolName').value || 'Ù†Ø§Ù… Ù…Ø¯Ø±Ø³Ù‡',
            grade: document.getElementById('grade').value || 'Ù¾Ø§ÛŒÙ‡ ØªØ­ØµÛŒÙ„ÛŒ'
          };
        }
      }).then(result => {
        if (result.isConfirmed) {
          userInfo = result.value;
          localStorage.setItem('userInfo', JSON.stringify(userInfo));
          const accuracy = totalAttempts > 0 ? Math.round((correctAttempts / totalAttempts) * 100) : 0;
          const avgTime = completedWords > 0 ? Math.round(totalRoundTime / completedWords) : 0;
          const accuracyRating = accuracy >= 90 ? 'Ø¹Ø§Ù„ÛŒ' : accuracy >= 70 ? 'Ø®ÙˆØ¨' : accuracy >= 50 ? 'Ù…ØªÙˆØ³Ø·' : 'Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ù‡Ø¨ÙˆØ¯';
          const avgTimeRating = avgTime <= 10 ? 'Ø¹Ø§Ù„ÛŒ' : avgTime <= 20 ? 'Ø®ÙˆØ¨' : avgTime <= 30 ? 'Ù…ØªÙˆØ³Ø·' : 'Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ù‡Ø¨ÙˆØ¯';
          const streakRating = streak >= 10 ? 'Ø¹Ø§Ù„ÛŒ' : streak >= 5 ? 'Ø®ÙˆØ¨' : streak >= 1 ? 'Ù…ØªÙˆØ³Ø·' : 'Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ù‡Ø¨ÙˆØ¯';
          const levelRating = level >= 5 ? 'Ø¹Ø§Ù„ÛŒ' : level >= 3 ? 'Ø®ÙˆØ¨' : level >= 2 ? 'Ù…ØªÙˆØ³Ø·' : 'Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ù‡Ø¨ÙˆØ¯';
          const reportCardHtml = `
            <div style="font-family: 'Vazir', sans-serif; direction: rtl; text-align: right; padding: 20px; max-width: 800px; margin: 0 auto;">
              <h2 style="text-align: center; color: var(--accent);">Ú©Ø§Ø±Ù†Ø§Ù…Ù‡ Ø¨Ø§Ø²ÛŒ Ø§Ù…Ù„Ø§</h2>
              <h3 style="text-align: center; color: var(--text);">Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø­Ø±ÙˆÙ Ùˆ Ø¬Ù…Ù„Ø§Øª (Ù…Ø®ØµÙˆØµ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø§Ø¨ØªØ¯Ø§ÛŒÛŒ)</h3>
              <p style="text-align: center;">${new Date().toLocaleDateString('fa-IR')}</p>
              <hr style="border: 1px solid var(--accent); margin: 20px 0;">
              <h3>Ù…Ø´Ø®ØµØ§Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²</h3>
              <table style="width: 100%; margin-bottom: 20px;">
                <tr><td style="padding: 8px;"><b>Ù†Ø§Ù…:</b></td><td style="padding: 8px;">${userInfo.firstName}</td></tr>
                <tr><td style="padding: 8px;"><b>Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ:</b></td><td style="padding: 8px;">${userInfo.lastName}</td></tr>
                <tr><td style="padding: 8px;"><b>Ú©Ø¯ Ù…Ù„ÛŒ:</b></td><td style="padding: 8px;">${userInfo.nationalId}</td></tr>
                <tr><td style="padding: 8px;"><b>Ù†Ø§Ù… Ù…Ø¯Ø±Ø³Ù‡:</b></td><td style="padding: 8px;">${userInfo.schoolName}</td></tr>
                <tr><td style="padding: 8px;"><b>Ù¾Ø§ÛŒÙ‡ ØªØ­ØµÛŒÙ„ÛŒ:</b></td><td style="padding: 8px;">${userInfo.grade}</td></tr>
              </table>
              <h3>Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¯Ø± Ø¨Ø§Ø²ÛŒ</h3>
              <table style="width: 100%; margin-bottom: 20px;">
                <tr><td style="padding: 8px;"><b>Ø§Ù…ØªÛŒØ§Ø²:</b></td><td style="padding: 8px;">${score}</td></tr>
                <tr><td style="padding: 8px;"><b>Ø³Ø·Ø­:</b></td><td style="padding: 8px;">${level}</td></tr>
                <tr><td style="padding: 8px;"><b>Ø±Ú¯Ù‡ (Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ù…ØªÙˆØ§Ù„ÛŒ Ø¯Ø±Ø³Øª):</b></td><td style="padding: 8px;">${streak}</td></tr>
                <tr><td style="padding: 8px;"><b>Ú©Ù„Ù…Ø§Øª/Ø¬Ù…Ù„Ø§Øª Ú©Ø§Ù…Ù„â€ŒØ´Ø¯Ù‡:</b></td><td style="padding: 8px;">${completedWords}</td></tr>
                <tr><td style="padding: 8px;"><b>Ú©Ù„ Ú©Ù„Ù…Ø§Øª/Ø¬Ù…Ù„Ø§Øª:</b></td><td style="padding: 8px;">${totalWords}</td></tr>
                <tr><td style="padding: 8px;"><b>Ø¯Ù‚Øª:</b></td><td style="padding: 8px;">${accuracy}%</td></tr>
                <tr><td style="padding: 8px;"><b>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø²Ù…Ø§Ù† Ù‡Ø± Ø¯ÙˆØ±:</b></td><td style="padding: 8px;">${avgTime} Ø«Ø§Ù†ÛŒÙ‡</td></tr>
              </table>
              <h3>ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´ Ùˆ ØªÙˆØ§Ù†Ø§ÛŒÛŒ</h3>
              <table class="report-card-table">
                <tr>
                  <th>Ù…Ø¹ÛŒØ§Ø±</th>
                  <th>Ù†Ù…Ø±Ù‡</th>
                  <th>ØªÙˆØ¶ÛŒØ­</th>
                </tr>
                <tr>
                  <td>Ø¯Ù‚Øª</td>
                  <td>${accuracyRating}</td>
                  <td>Ø¯Ù‚Øª Ø¨Ø§Ù„Ø§ Ù†Ø´Ø§Ù†â€ŒØ¯Ù‡Ù†Ø¯Ù‡ ØªÙˆØ§Ù†Ø§ÛŒÛŒ Ù‚ÙˆÛŒ Ø¯Ø± Ø§Ù…Ù„Ø§ Ùˆ ØªØ´Ø®ÛŒØµ ØªØ±ØªÛŒØ¨ Ø¯Ø±Ø³Øª Ø§Ø³Øª.</td>
                </tr>
                <tr>
                  <td>Ø³Ø±Ø¹Øª</td>
                  <td>${avgTimeRating}</td>
                  <td>Ø³Ø±Ø¹Øª Ø¨Ø§Ù„Ø§ Ù†Ø´Ø§Ù†â€ŒØ¯Ù‡Ù†Ø¯Ù‡ ÙˆØ§Ú©Ù†Ø´ Ø³Ø±ÛŒØ¹ Ùˆ ØªÙ…Ø±Ú©Ø² Ù‚ÙˆÛŒ Ø§Ø³Øª.</td>
                </tr>
                <tr>
                  <td>Ø±Ú¯Ù‡</td>
                  <td>${streakRating}</td>
                  <td>Ø±Ú¯Ù‡ Ø¨Ø§Ù„Ø§ Ù†Ø´Ø§Ù†â€ŒØ¯Ù‡Ù†Ø¯Ù‡ Ø«Ø¨Ø§Øª Ùˆ Ù¾Ø´ØªÚ©Ø§Ø± Ø¯Ø± Ø­Ù„ Ù…Ø³Ø§Ø¦Ù„ Ø§Ø³Øª.</td>
                </tr>
                <tr>
                  <td>Ø³Ø·Ø­</td>
                  <td>${levelRating}</td>
                  <td>Ø³Ø·Ø­ Ø¨Ø§Ù„Ø§ Ù†Ø´Ø§Ù†â€ŒØ¯Ù‡Ù†Ø¯Ù‡ Ù¾ÛŒØ´Ø±ÙØª Ù‚Ø§Ø¨Ù„â€ŒØªÙˆØ¬Ù‡ Ø¯Ø± Ø¨Ø§Ø²ÛŒ Ø§Ø³Øª.</td>
                </tr>
              </table>
              <p style="text-align: center; font-size: 12px; margin-top: 20px;">
                Ø§ÛŒÙ† Ú©Ø§Ø±Ù†Ø§Ù…Ù‡ Ù†Ø´Ø§Ù†â€ŒØ¯Ù‡Ù†Ø¯Ù‡ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø± Ø¨Ø§Ø²ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ Ø§Ù…Ù„Ø§ Ø§Ø³Øª.<br>
                ØªØ§Ø±ÛŒØ®: ${new Date().toLocaleDateString('fa-IR')}
              </p>
            </div>
          `;
          const tempDiv = document.createElement('div');
          tempDiv.innerHTML = reportCardHtml;
          document.body.appendChild(tempDiv);
          Swal.fire({
            title: 'Ú©Ø§Ø±Ù†Ø§Ù…Ù‡ Ø´Ù…Ø§',
            html: reportCardHtml,
            showCancelButton: true,
            confirmButtonText: 'Ú†Ø§Ù¾',
            cancelButtonText: 'Ø¨Ø³ØªÙ†',
            showDenyButton: true,
            denyButtonText: 'Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¹Ú©Ø³',
            showCloseButton: true,
            width: '800px'
          }).then(result => {
            if (result.isConfirmed) {
              html2canvas(tempDiv, { scale: 2 }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const printFrame = document.getElementById('printFrame');
                const doc = printFrame.contentWindow.document;
                doc.open();
                doc.write(`
                  <html>
                    <head>
                      <style>
                        body { margin: 0; display: flex; justify-content: center; align-items: center; }
                        img { max-width: 100%; height: auto; }
                      </style>
                    </head>
                    <body>
                      <img src="${imgData}" style="max-width: 210mm; max-height: 297mm;">
                    </body>
                  </html>
                `);
                doc.close();
                printFrame.contentWindow.focus();
                printFrame.contentWindow.print();
                confetti({
                  particleCount: 200,
                  spread: 100,
                  origin: { y: 0.5 },
                  colors: ['#ff6f61', '#2ecc71', '#ffd700']
                });
                Swal.fire({
                  icon: 'success',
                  title: 'Ú©Ø§Ø±Ù†Ø§Ù…Ù‡ Ø¢Ù…Ø§Ø¯Ù‡ Ú†Ø§Ù¾',
                  text: 'ØªØµÙˆÛŒØ± Ú©Ø§Ø±Ù†Ø§Ù…Ù‡ Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ú†Ø§Ù¾ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª! ğŸ–¨ï¸',
                  timer: 1500,
                  showConfirmButton: false
                });
                document.body.removeChild(tempDiv);
              });
            } else if (result.isDenied) {
              html2canvas(tempDiv, { scale: 2 }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'report_card.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
                Swal.fire({
                  icon: 'success',
                  title: 'Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¹Ú©Ø³',
                  text: 'ØªØµÙˆÛŒØ± Ú©Ø§Ø±Ù†Ø§Ù…Ù‡ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯! ğŸ‰',
                  timer: 1500,
                  showConfirmButton: false
                });
                document.body.removeChild(tempDiv);
              });
            } else {
              document.body.removeChild(tempDiv);
            }
          });
        }
      });
    }

    function suggestSentences() {
      Swal.fire({
        title: 'Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¬Ù…Ù„Ø§Øª',
        html: `<input type="text" id="ageGrade" class="swal2-input" placeholder="Ø³Ù† ÛŒØ§ Ù¾Ø§ÛŒÙ‡ (Ù…Ø«Ø§Ù„: Ø³ÙˆÙ… Ø§Ø¨ØªØ¯Ø§ÛŒÛŒ)">`,
        confirmButtonText: 'ØªÙˆÙ„ÛŒØ¯ Ø¬Ù…Ù„Ø§Øª',
        cancelButtonText: 'Ù„ØºÙˆ',
        showCancelButton: true,
        preConfirm: () => {
          return document.getElementById('ageGrade').value;
        }
      }).then(result => {
        if (result.isConfirmed) {
          const input = result.value.toLowerCase().trim();
          let suggestedSentences = [];
          if (input.includes('Ø§ÙˆÙ„') || input.includes('1')) {
            suggestedSentences = [
              'Ù…Ù† Ø¨Ù‡ Ù…Ø¯Ø±Ø³Ù‡ Ù…ÛŒâ€ŒØ±ÙˆÙ…',
              'Ø§ÛŒÙ† ÛŒÚ© Ú©ØªØ§Ø¨ Ø§Ø³Øª',
              'Ù…Ø§ Ø¨Ø§Ø²ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…',
              'Ø®ÙˆØ±Ø´ÛŒØ¯ Ù…ÛŒâ€ŒØ¯Ø±Ø®Ø´Ø¯',
              'Ú¯Ø±Ø¨Ù‡ Ø±ÙˆÛŒ Ø¯ÛŒÙˆØ§Ø± Ø§Ø³Øª'
            ];
          } else if (input.includes('Ø¯ÙˆÙ…') || input.includes('2')) {
            suggestedSentences = [
              'Ù…Ù† Ø³ÛŒØ¨ Ù…ÛŒâ€ŒØ®ÙˆØ±Ù…',
              'Ú©ØªØ§Ø¨ Ø±ÙˆÛŒ Ù…ÛŒØ² Ø§Ø³Øª',
              'Ù…Ø§ Ø¨Ù‡ Ù¾Ø§Ø±Ú© Ù…ÛŒâ€ŒØ±ÙˆÛŒÙ…',
              'Ù¾Ø±Ù†Ø¯Ù‡ Ø¢ÙˆØ§Ø² Ù…ÛŒâ€ŒØ®ÙˆØ§Ù†Ø¯',
              'Ø§Ù…Ø±ÙˆØ² Ø±ÙˆØ² Ø®ÙˆØ¨ÛŒ Ø§Ø³Øª'
            ];
          } else if (input.includes('Ø³ÙˆÙ…') || input.includes('3')) {
            suggestedSentences = [
              'Ù¾Ø±Ù†Ø¯Ù‡ Ø¯Ø± Ø¢Ø³Ù…Ø§Ù† Ù¾Ø±ÙˆØ§Ø² Ù…ÛŒâ€ŒÚ©Ù†Ø¯',
              'Ù…Ø§ Ø¯Ø± Ø­ÛŒØ§Ø· Ø¨Ø§Ø²ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…',
              'Ø®ÙˆØ±Ø´ÛŒØ¯ Ø¯Ø± Ø¢Ø³Ù…Ø§Ù† Ø§Ø³Øª',
              'Ú¯Ø±Ø¨Ù‡ Ø±ÙˆÛŒ Ø¯Ø±Ø®Øª Ù…ÛŒâ€ŒØ±ÙˆØ¯',
              'Ù…Ù† Ú©ØªØ§Ø¨ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù†Ù…'
            ];
          } else {
            suggestedSentences = [
              'Ù…Ù† Ø¨Ù‡ Ù…Ø¯Ø±Ø³Ù‡ Ù…ÛŒâ€ŒØ±ÙˆÙ…',
              'Ø§ÛŒÙ† ÛŒÚ© Ú©ØªØ§Ø¨ Ø§Ø³Øª',
              'Ù…Ø§ Ø¨Ø§Ø²ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…',
              'Ø®ÙˆØ±Ø´ÛŒØ¯ Ø¯Ø± Ø¢Ø³Ù…Ø§Ù† Ø§Ø³Øª',
              'Ú¯Ø±Ø¨Ù‡ Ø±ÙˆÛŒ Ø¯ÛŒÙˆØ§Ø± Ø§Ø³Øª',
              'Ù…Ù† Ø³ÛŒØ¨ Ù…ÛŒâ€ŒØ®ÙˆØ±Ù…',
              'Ú©ØªØ§Ø¨ Ø±ÙˆÛŒ Ù…ÛŒØ² Ø§Ø³Øª',
              'Ù…Ø§ Ø¨Ù‡ Ù¾Ø§Ø±Ú© Ù…ÛŒâ€ŒØ±ÙˆÛŒÙ…',
              'Ù¾Ø±Ù†Ø¯Ù‡ Ø¯Ø± Ø¢Ø³Ù…Ø§Ù† Ù¾Ø±ÙˆØ§Ø² Ù…ÛŒâ€ŒÚ©Ù†Ø¯',
              'Ø§Ù…Ø±ÙˆØ² Ø±ÙˆØ² Ø®ÙˆØ¨ÛŒ Ø§Ø³Øª'
            ];
          }
          wordListEl.value = suggestedSentences.join('\n');
          Swal.fire({
            icon: 'success',
            title: 'Ø¬Ù…Ù„Ø§Øª Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ',
            text: 'ÙÙ‡Ø±Ø³Øª Ø¬Ù…Ù„Ø§Øª Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯. Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ØŒ Â«Ø§Ø¹Ù…Ø§Ù„ ÙÙ‡Ø±Ø³ØªÂ» Ø±Ø§ Ø¨Ø²Ù†.',
            timer: 2000,
            showConfirmButton: false
          });
        }
      });
    }

    document.getElementById('newBtn').addEventListener('click', () => {
      newRound();
    });
    document.getElementById('shuffleTiles').addEventListener('click', () => {
      shuffleTiles();
    });
    document.getElementById('checkBtn').addEventListener('click', () => {
      checkIfComplete();
    });
    document.getElementById('retryBtn').addEventListener('click', () => {
      retryRound();
    });
    document.getElementById('themeBtn').addEventListener('click', () => {
      toggleTheme();
    });
    document.getElementById('resetBtn').addEventListener('click', () => {
      resetGame();
    });
    document.getElementById('printBtn').addEventListener('click', () => {
      printReportCard();
    });
    document.getElementById('suggestBtn').addEventListener('click', () => {
      suggestSentences();
    });
    document.getElementById('applyBtn').addEventListener('click', () => {
      Swal.fire({
        icon: 'warning',
        title: 'Ø§Ø¹Ù…Ø§Ù„ ÙÙ‡Ø±Ø³Øª',
        text: 'Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ÙÙ‡Ø±Ø³Øª Ø¬Ù…Ù„Ø§Øª Ø±Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ù†ÛŒØ¯ØŸ',
        showCancelButton: true,
        confirmButtonText: 'Ø¨Ù„Ù‡',
        cancelButtonText: 'Ø®ÛŒØ±'
      }).then(result => {
        if (result.isConfirmed) {
          saveWordList();
        }
      });
    });
    document.getElementById('modeBtn').addEventListener('click', () => {
      if (mode === 'syllable') {
        mode = 'letter';
        document.getElementById('modeBtn').textContent = 'Ø­Ø§Ù„Øª: Ø­Ø±Ù';
      } else if (mode === 'letter') {
        mode = 'sentence';
        document.getElementById('modeBtn').textContent = 'Ø­Ø§Ù„Øª: Ø¬Ù…Ù„Ù‡';
      } else {
        mode = 'syllable';
        document.getElementById('modeBtn').textContent = 'Ø­Ø§Ù„Øª: Ø³ÛŒÙ„Ø§Ø¨';
      }
      saveSettings();
    });
    document.getElementById('gameModeBtn').addEventListener('click', () => {
      if (gameMode === 'normal') {
        gameMode = 'timed';
        document.getElementById('gameModeBtn').textContent = 'Ø­Ø§Ù„Øª Ø¨Ø§Ø²ÛŒ: Ø²Ù…Ø§Ù†â€ŒØ¯Ø§Ø±';
      } else if (gameMode === 'timed') {
        gameMode = 'challenge';
        document.getElementById('gameModeBtn').textContent = 'Ø­Ø§Ù„Øª Ø¨Ø§Ø²ÛŒ: Ú†Ø§Ù„Ø´';
        clearInterval(timerInterval);
        timerCircleEl.style.display = 'none';
        promptEl.textContent = mode === 'sentence' ? 'Ø¬Ù…Ù„Ù‡ Ø¬Ø¯ÛŒØ¯ â€” ØªØ±ØªÛŒØ¨ Ø±Ø§ Ø¯Ø±Ø³Øª Ú©Ù†' : `Ú©Ù„Ù…Ù‡ Ø¬Ø¯ÛŒØ¯ â€” ØªØ±ØªÛŒØ¨ Ø±Ø§ Ø¯Ø±Ø³Øª Ú©Ù†: ${current}`;
      } else {
        gameMode = 'normal';
        document.getElementById('gameModeBtn').textContent = 'Ø­Ø§Ù„Øª Ø¨Ø§Ø²ÛŒ: Ø¹Ø§Ø¯ÛŒ';
        clearInterval(timerInterval);
        timerCircleEl.style.display = 'none';
        promptEl.textContent = mode === 'sentence' ? 'Ø¬Ù…Ù„Ù‡ Ø¬Ø¯ÛŒØ¯ â€” ØªØ±ØªÛŒØ¨ Ø±Ø§ Ø¯Ø±Ø³Øª Ú©Ù†' : `Ú©Ù„Ù…Ù‡ Ø¬Ø¯ÛŒØ¯ â€” ØªØ±ØªÛŒØ¨ Ø±Ø§ Ø¯Ø±Ø³Øª Ú©Ù†: ${current}`;
      }
      saveSettings();
    });

    (function init() {
      loadWordList();
      loadSettings();
      scoreEl.textContent = score;
      updateProgress();
      updateStreak();
      levelEl.textContent = `Ø³Ø·Ø­: ${level}`;
      movesEl.textContent = `Ø­Ø±Ú©Ø§Øª Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: ${moveCount}`;
      mistakesEl.textContent = `Ø§Ø´ØªØ¨Ø§Ù‡Ø§Øª Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: ${mistakeCount}`;
      msgEl.textContent = 'Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Â«Ø¬Ø¯ÛŒØ¯Â» Ø±Ø§ Ø¨Ø²Ù†. ÙÙ‚Ø· Ø¬Ù…Ù„Ø§Øª Ø±Ø§ Ø¯Ø± ÙÙ‡Ø±Ø³Øª ÙˆØ§Ø±Ø¯ Ú©Ù†!';
    })();
  </script>
</body>
</html>